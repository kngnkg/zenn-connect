---
title: "Dev Container å†…ã§ Go ã‚µãƒ¼ãƒãƒ¼ã‚’ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ã—ãªãŒã‚‰ãƒ‡ãƒãƒƒã‚¬ã‚’ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ (VSCode)"
emoji: "ğŸ°"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Go", "VSCode", "DevContainer", "Air", "Delve"]
published: true
---

ã“ã®è¨˜äº‹ã§ã¯ã€`VSCode` ã® `Dev Container` ã§ `Go` ã‚µãƒ¼ãƒãƒ¼ã‚’ `Air` ã§ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ã•ã›ãªãŒã‚‰ã€åŒæ™‚ã«ãƒ‡ãƒãƒƒã‚¬ã‚’ã‚¢ã‚¿ãƒƒãƒã™ã‚‹æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚

Goã®ãƒ‡ãƒãƒƒã‚¬ã«ã¯ `Delve` ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

## å‰ææ¡ä»¶

- `VSCode` ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹
- `VSCode` ã® `Dev Containers` æ‹¡å¼µæ©Ÿèƒ½ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹

## æ‰‹é †

### 1. `docker-compose.yml` ã®ä½œæˆ

```yaml
version: '3.7'
services:
  app:
    container_name: go
    build:
      context: .
      dockerfile: ./path/to/Dockerfile
    volumes:
      - .:/workspace:cached
    ports:
      - "18000:8080"

```

ä»Šå›ã¯ `Dev Container` å†…ã§é–‹ç™ºã™ã‚‹ã®ã§ã€`Delve` ç”¨ã«ãƒãƒ¼ãƒˆã‚’é–‹ã‘ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

### 1. `Dockefile` ã®ä½œæˆ

```dockerfile
FROM golang:1.20.3

ENV GO111MODULE on

WORKDIR /workspace

# delve ã¨ Air ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
RUN go install github.com/go-delve/delve/cmd/dlv@latest && \
    go install github.com/cosmtrek/air@latest
    # ... (ãã®ä»–å¿…è¦ãªãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«)

# Air ã‚’èµ·å‹•
CMD ["air", "-c", ".air.toml"]

```

### 2. `.air.toml` ã®è¨­å®š

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ `.air.toml` ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

```bash
air init
```

ç”Ÿæˆã•ã‚ŒãŸ`.air.toml` ã® `cmd` ã¨ `full_bin` ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ç·¨é›†ã—ã¾ã™ã€‚

```toml
# ... (ãã®ä»–ã®è¨­å®š)

[build]
  cmd = "go build -gcflags=\"all=-N -l\" -o ./tmp/main ."
  full_bin = "dlv --headless=true --listen=:40000 --api-version=2 --accept-multiclient exec --continue ./tmp/main"

```

#### `cmd`

Goã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒ“ãƒ«ãƒ‰ã—ã¾ã™ã€‚
`-gcflags=\"all=-N -l\"`ã§ã™ã¹ã¦ã®ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦æœ€é©åŒ–ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€`delve` ãŒãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆã‚’èªè­˜ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

#### `full_bin`

`delve`ã®ãƒ‡ãƒãƒƒã‚°ç”¨ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¾ã™ã€‚

### 3. `launch.json` ã®ä½œæˆ

`.vscode/launch.json` ã‚’ä½œæˆã—ã€ä»¥ä¸‹ã®å†…å®¹ã‚’è¨˜è¿°ã—ã¾ã™ã€‚

```json
{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Attach to Server",
            "type": "go",
            "request": "attach",
            "mode": "remote",
            "remotePath": "/workspace",
            "port": 40000,
            "host": "localhost",
            "showLog": true
        }
    ]
}
```

ã“ã‚Œã§ã€`F5` ã§ãƒ‡ãƒãƒƒã‚¬ã‚’ã‚¢ã‚¿ãƒƒãƒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

## å‹•ä½œç¢ºèª

### 1. ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•

```bash
docker-compose up -d
```

### 2. `Dev Container` ã«æ¥ç¶š

VSCode ã®ã‚³ãƒãƒ³ãƒ‰ãƒ‘ãƒ¬ãƒƒãƒˆã‹ã‚‰ã€`Dev Containers: Open Folder in Container...` ã‚’é¸æŠã—ã€`workspace` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’é–‹ãã¾ã™ã€‚

![](/images/screenshot-2023-08-08-21.02.00.png)

### 3. ãƒ‡ãƒãƒƒã‚¬ã‚’ã‚¢ã‚¿ãƒƒãƒ

`F5` ã‚’æŠ¼ã—ã¦ã€ãƒ‡ãƒãƒƒã‚¬ã‚’ã‚¢ã‚¿ãƒƒãƒã—ã¾ã™ã€‚

### 4. ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆã§æ­¢ã¾ã‚‹ã“ã¨ã‚’ç¢ºèª

![](/images/screenshot-2023-08-08-20.55.11.png)

## ã¾ã¨ã‚

`Dev Container` ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ã—ãªãŒã‚‰ãƒ‡ãƒãƒƒã‚°ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã€é–‹ç™ºãŒå¿«é©ã«ãªã‚Šã¾ã—ãŸã€‚

## å‚è€ƒ

https://github.com/go-delve/delve/blob/master/Documentation/

https://github.com/cosmtrek/air

https://code.visualstudio.com/docs/editor/debugging
