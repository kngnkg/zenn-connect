---
title: "Dev Container å†…ã§ Go ã‚µãƒ¼ãƒãƒ¼ã‚’ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ã—ãªãŒã‚‰ãƒ‡ãƒãƒƒã‚¬ã‚’ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ (VSCode)"
emoji: "ğŸ“"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Go", "VSCode", "DevContainer", "Air", "Delve"]
published: false
---

ã“ã®è¨˜äº‹ã§ã¯ã€`VSCode` ã® `Dev Container` ã§ `Go` ã‚µãƒ¼ãƒãƒ¼ã‚’ `Air` ã§ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ã•ã›ãªãŒã‚‰ã€åŒæ™‚ã«ãƒ‡ãƒãƒƒã‚¬ã‚’ã‚¢ã‚¿ãƒƒãƒã™ã‚‹æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚

Goã®ãƒ‡ãƒãƒƒã‚¬ã«ã¯ `Delve` ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

## å‰ææ¡ä»¶

- `VSCode` ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹
- `VSCode` ã® `Dev Containers` æ‹¡å¼µæ©Ÿèƒ½ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹

## æ¦‚è¦

`VSCode` ã® `Dev Container` ã§ã¯ã€`Dockerfile` ã¨ `docker-compose.yml` ã‚’ä½¿ç”¨ã—ã¦ã€é–‹ç™ºç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚......

## `Air`ã«ã¤ã„ã¦


## æ‰‹é †

### 1. `docker-compose.yml` ã®ä½œæˆ

```yaml

  reverse-proxy:
    container_name: tunetrail-reverse-proxy
    hostname: tunetrail-reverse-proxy
    build:
      context: .
      target: dev
      dockerfile: ./reverse-proxy-for-dev/Dockerfile
    volumes:
      # .gitã‚’å«ã‚€ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡å®šã™ã‚‹
      - .:/workspace:cached
    ports:
      - "18001:8080"
      - "40000:40000" # ãƒ‡ãƒãƒƒã‚°ç”¨,ã„ã‚‹ï¼Ÿ
    networks:
      - tunetrail-internal
      - tunetrail-external

```

...

### 1. `Dockefile` ã®ä½œæˆ

```dockerfile
FROM golang:1.20.3 as dev

ENV GO111MODULE on

WORKDIR /app

# delve ã¨ Air ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
RUN go install -v github.com/go-delve/delve/cmd/dlv@latest && \
    go install github.com/cosmtrek/air@latest
    ## ãã®ä»–å¿…è¦ãªãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

CMD ["air", "-c", ".air.toml"]

```

### 2. `.air.toml` ã®ä½œæˆ

```toml
# ... (ãã®ä»–ã®è¨­å®š)

[build]
  cmd = "go build -gcflags=\"all=-N -l\" -o ./tmp/main ."
  full_bin = "dlv --headless=true --listen=:40000 --api-version=2 --accept-multiclient exec --continue ./tmp/main"

```

`-gcflags=all='-N -l'` ã¯ã€delveã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã«å¿…è¦ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã™ã€‚

ã“ã“ã§ã¯ã€`dlv debug` ã‚’ä½¿ã£ã¦ã‚µãƒ¼ãƒãƒ¼ã‚’ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã§èµ·å‹•ã—ã€40000ç•ªãƒãƒ¼ãƒˆã§å¾…ã¡å—ã‘ã‚‹ã‚ˆã†ã«è¨­å®šã—ã¦ã„ã¾ã™ã€‚


### 3. `launch.json` ã®ä½œæˆ

`.vscode/launch.json` ã«ä»¥ä¸‹ã®è¨­å®šã‚’è¿½åŠ ã—ã¾ã™ã€‚

```json
{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Attach to Server",
            "type": "go",
            "request": "attach",
            "mode": "remote",
            // "remotePath": "/app",
            "remotePath": "/workspace/reverse-proxy-for-dev",
            "port": 40000,
            "host": "localhost",
            "showLog": true
        }
    ]
}
```

ã“ã‚Œã§ã€VSCode ã§ãƒ‡ãƒãƒƒã‚¬ã‚’èµ·å‹•ã—ã€ŒAttach to Serverã€ã¨ã„ã†è¨­å®šã‚’é¸æŠã™ã‚‹ã“ã¨ã§ã€Go ã‚µãƒ¼ãƒãƒ¼ã«ãƒ‡ãƒãƒƒã‚¬ã‚’ã‚¢ã‚¿ãƒƒãƒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

## å‹•ä½œç¢ºèª

## ã¾ã¨ã‚

## å‚è€ƒ

https://github.com/go-delve/delve/blob/master/Documentation/
